<html><head> 
    <title>SPOT Automated Testing</title>

	<link rel="stylesheet" type="text/css" href="../spot.css">

    <!--If running tests that do not have to do with the interface, run jsbuild.sh or jsbuild.bat
        in root directory of the project. If running interface testing, run testbuild.sh
        or testBuild.bat-->
    <script src="../build/spot.js"></script>

    <!--Mocha setup stuff (1/2)-->
    <meta charset="UTF-8">
    <script src="../lib/test/mocha.min.js"></script>
    <script src="../lib/test/chai.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../lib/test/mocha.css">
    <!--mocha setup stuff to be continued in document body-->
    
</head>
<body style="padding-left: 5%; padding-right: 5%; padding-top: 20px">

    <h2>Automatic Tree Trimming Tests</h2>
    <p>Tests the following functions:<p>- trimSilentTerminals()</p><p>- trimRedundantNodes()</p><p>- trimSpecifiedNodes()</p><p>- trimDeadEndNodes()</p></p>

    <!--Mocha stuff (2/2)-->
    <script>
        mocha.setup("bdd"); //brings "describe", "it", etc. into global namespace
        //mocha.checkLeaks();
        var assert = chai.assert; //no one wants to type out "chai.assert" every time
    </script>
    <div id="mocha">
        
    </div>

    <!--Mocha is set up now, you just need to write and run tests-->
    <script>

        stree1 = {
            "id": "T1",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "id": "c",
                            "cat": "x0"
                        },
                        {
                            "id": "d",
                            "cat": "x0"
                        }
                    ]
                }
            ]
        };

        stree2 = {
            "id": "T2",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "id": "c",
                            "cat": "x0",
                            "silent": true
                        },
                        {
                            "id": "d",
                            "cat": "x0"
                        }
                    ]
                }
            ]
        };

        stree3 = {
            "id": "T3",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "id": "c",
                            "cat": "bitcoin"
                        },
                        {
                            "id": "d",
                            "cat": "x0"
                        }
                    ]
                }
            ]
        };

        stree4 = {
            "id": "T4",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0",
                            "silent": true
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "id": "c",
                            "cat": "ethereum"
                        },
                        {
                            "id": "d",
                            "cat": "x0"
                        }
                    ]
                }
            ]
        };

        stree5 = {
            "id": "T5",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_7",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "cat": "xp",
                            "id": "XP_5",
                            "children": [
                                {
                                    "id": "c",
                                    "cat": "x0"
                                },
                                {
                                    "id": "d",
                                    "cat": "x0"
                                }
                            ]
                        }
                    ]
                }
            ]
        };

        stree6 = {
            "id": "T6",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_4",
                    "children": [
                        {
                            "id": "c",
                            "cat": "x0",
                            "silent": true
                        }
                    ]
                }
            ]
        };

        stree7 = {
            "id": "T7",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_4",
                    "children": [
                        {
                            "id": "c",
                            "cat": "monero"
                        }
                    ]
                }
            ]
        };

        stree8 = {
            "id": "T8",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_6",
                    "children": [
                        {
                            "id": "a",
                            "cat": "x0"
                        },
                        {
                            "id": "b",
                            "cat": "x0"
                        }
                    ]
                },
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "id": "c",
                            "cat": "x0",
                            "silent": true
                        },
                        {
                            "id": "d",
                            "cat": "dogecoin"
                        }
                    ]
                }
            ]
        };

        stree9 = {
            "id": "T9",
            "cat": "cp",
            "children": [
                {
                    "cat": "xp",
                    "id": "XP_5",
                    "children": [
                        {
                            "cat": "cp",
                            "id": "XP_4",
                            "children": [
                                {
                                    "id": "a",
                                    "cat": "x0",
                                    "silent": true
                                },
                                {
                                    "cat": "xp",
                                    "id": "XP_3",
                                    "children": [
                                        {
                                            "id": "b",
                                            "cat": "x0"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        };


        describe('Tree Trimming Tests', function() {
            it('Does nothing if tree is OK', function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree1,'silent')),'{[a b] [c d]}');
            });
            it('Removes silent terminals', function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree2,'silent')),'{[a b] [d]}');
            });
            it('Removes terminals with invalid categories', function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree3,'silent')),'{[a b] [d]}');
            });
            it('Removes silent and invalid terminals', function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree4,'silent')),'{[a] [d]}');
            });
            it("Removes instances of recursion", function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree5,'silent')),'{[a b] [c d]}');
            });
            it("Removes instances of recursion after silent terminal removal", function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree6,'silent')),'{[a b]}');
            });
            it("Removes instances of recursion after invalid terminal removal", function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree7,'silent')),'{[a b]}');
            });
            it("Removes instances of recursion after silent and invalid terminal removal", function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree8,'silent')),'{[a b]}');
            });
            it('Leaves embedded CPs', function() {
                assert.equal(parenthesizeTree(removeSpecifiedNodes(stree9,'silent')),'{[{[b]}]}');
            });
        });

        mocha.run(); //don't forget to run the test!!!
    </script>
    <!--That's all you need for testing with mocha and chai-->


</body></html>
